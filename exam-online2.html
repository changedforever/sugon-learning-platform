<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>在线考试 - 光合技术支持平台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 图标库 -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      background: #FFFFFF;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(14px);
      border: 1px solid #e5e7eb;
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    .question-nav-item-active {
      background: rgba(176, 31, 36, 0.25);
      border-color: #B01F24;
    }
    .question-nav-item-answered {
      border-left: 3px solid #22c55e;
    }
    .question-nav-item-flagged {
      border-left: 3px solid #eab308;
    }

    .progress-bar-track { background: #f3f4f6; }
    .progress-bar-fill {
      background: linear-gradient(to right, #B01F24, #d946ef);
    }

    .overlay {
      background: rgba(0,0,0,0.5);
    }
  </style>
</head>
<body class="bg-white text-gray-800">

<!-- 顶部导航 + 全站搜索 -->
<header class="fixed top-0 inset-x-0 z-50 bg-white backdrop-blur-xl border-b border-gray-300">
  <div class="max-w-7xl mx-auto px-4 lg:px-6">
    <div class="flex items-center justify-between h-16">
      <!-- LOGO + 品牌 -->
      <div class="flex items-center space-x-2">
        <a href="index.html" class="cursor-pointer hover:opacity-80 transition-opacity duration-200">
          <img src="images/logo2.png" alt="HIECO Logo" class="h-32 w-32 object-contain">
        </a>
        <div>
          <!--div class="text-xs uppercase tracking-widest text-white">HIECO</div-->
          <a href="index.html" class="cursor-pointer hover:opacity-80 transition-opacity duration-200">
            <div class="text-sm font-semibold text-[#2D874B] hover:text-[#256e3d] transition-colors duration-200">光合技术支持平台</div>
          </a>
        </div>
      </div>

      <!-- 导航入口（桌面端） -->
      <nav class="hidden md:flex items-center space-x-4 text-base">
        <!-- 专家 - 无下拉 -->
        <a href="expert-center.html" class="px-4 py-2 rounded-full hover:bg-gray-300 transition text-gray-800 font-medium">
          专家
        </a>

        <div class="nav-dropdown relative group">
          <a href="training.html" class="px-4 py-2 rounded-full bg-[#2D874B] text-white transition text-gray-800 flex items-center gap-1 cursor-pointer font-medium">
            培训
            <i class="fa fa-chevron-down text-sm text-white"></i>
          </a>
          <div class="nav-dropdown-menu absolute top-full left-0 mt-2 w-96 bg-white rounded-2xl shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
            <div class="p-4">
              <div class="grid grid-cols-2 gap-4">
                <!-- 左侧：二级菜单 -->
                <div class="space-y-3">
                  <!-- 课程（原培训） -->
                  <div class="nav-item group/item relative">
                    <a href="course-list2.html" class="text-sm font-medium text-gray-800 hover:text-[#2D874B] flex items-center justify-between">
                      课程
                      <i class="fa fa-chevron-right text-xs opacity-0 group-hover/item:opacity-100"></i>
                    </a>
                    <div class="nav-submenu absolute left-full top-0 ml-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 opacity-0 invisible group-hover/item:opacity-100 group-hover/item:visible transition-all duration-300 z-50">
                      <div class="p-3">
                        <h4 class="text-sm font-semibold text-gray-800 mb-2">课程分类</h4>
                        <div class="grid grid-cols-2 gap-2">
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">云基础设施</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">AI与数据智能</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">解决方案</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">安全技术</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">运维管理</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">开发技术</a>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 考试 -->
                  <div class="nav-item group/item relative">
                    <a href="exam-list.html" class="text-sm font-medium text-gray-800 hover:text-[#2D874B] flex items-center justify-between">
                      考试
                      <i class="fa fa-chevron-right text-xs opacity-0 group-hover/item:opacity-100"></i>
                    </a>
                    <div class="nav-submenu absolute left-full top-0 ml-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 opacity-0 invisible group-hover/item:opacity-100 group-hover/item:visible transition-all duration-300 z-50">
                      <div class="p-3">
                        <h4 class="text-sm font-semibold text-gray-800 mb-2">考试分类</h4>
                        <div class="grid grid-cols-2 gap-2">
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">资格认证考试</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">技能水平考试</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">岗位能力考试</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">产品认证考试</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">在线考试</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">线下考试</a>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 认证 -->
                  <div class="nav-item group/item relative">
                    <a href="certification.html" class="text-sm font-medium text-gray-800 hover:text-[#2D874B] flex items-center justify-between">
                      认证
                      <i class="fa fa-chevron-right text-xs opacity-0 group-hover/item:opacity-100"></i>
                    </a>
                    <div class="nav-submenu absolute left-full top-0 ml-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 opacity-0 invisible group-hover/item:opacity-100 group-hover/item:visible transition-all duration-300 z-50">
                      <div class="p-3">
                        <h4 class="text-sm font-semibold text-gray-800 mb-2">认证分类</h4>
                        <div class="grid grid-cols-2 gap-2">
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">通用计算认证</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">智能计算认证</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">行业解决方案认证</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">专业技术认证</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">初级认证</a>
                          <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] py-1">高级认证</a>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 讲师 -->
                  <a href="lecturer-list.html" class="text-sm font-medium text-gray-800 hover:text-[#2D874B] block">
                    讲师
                  </a>
                </div>
                
                <!-- 右侧：快速入口 -->
                <div class="space-y-3">
                  <h3 class="text-sm font-semibold text-gray-800 mb-2">快速入口</h3>
                  <div class="space-y-2">
                    <a href="personal-center.html" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1 flex items-center gap-2">
                      <i class="fa fa-user text-[#2D874B] text-xs"></i>
                      个人中心
                    </a>
                    <a href="task-detail.html" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1 flex items-center gap-2">
                      <i class="fa fa-tasks text-[#2D874B] text-xs"></i>
                      我的任务
                    </a>
                    <a href="course-learning.html" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1 flex items-center gap-2">
                      <i class="fa fa-book text-[#2D874B] text-xs"></i>
                      继续学习
                    </a>
                    <a href="certification.html" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1 flex items-center gap-2">
                      <i class="fa fa-certificate text-[#2D874B] text-xs"></i>
                      我的证书
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 直播 - 带下拉浮窗 -->
        <div class="nav-dropdown relative group">
          <a href="live-list.html" class="px-4 py-2 rounded-full hover:bg-gray-300 transition text-gray-800 flex items-center gap-1 font-medium">
            直播
            <i class="fa fa-chevron-down text-sm text-gray-500"></i>
          </a>
          <div class="nav-dropdown-menu absolute top-full left-0 mt-2 w-80 bg-white rounded-2xl shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
            <div class="p-4">
              <div class="grid grid-cols-2 gap-4">
                <div class="space-y-2">
                  <h3 class="text-sm font-semibold text-gray-800 mb-2">直播状态</h3>
                  <div class="space-y-1">
                    <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1">未开始</a>
                    <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1">直播中</a>
                    <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1">已结束</a>
                    <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1">可预约</a>
                  </div>
                </div>
                <div class="space-y-2">
                  <h3 class="text-sm font-semibold text-gray-800 mb-2">直播类型</h3>
                  <div class="space-y-1">
                    <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1">技术分享</a>
                    <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1">产品发布</a>
                    <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1">案例解析</a>
                    <a href="#" class="text-xs text-gray-600 hover:text-[#2D874B] block py-1">专家访谈</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 其他导航项（无下拉） -->
        <a href="#" class="px-4 py-2 rounded-full hover:bg-gray-300 transition text-gray-800 font-medium">论坛</a>
        <a href="resource-center.html" class="px-4 py-2 rounded-full hover:bg-gray-300 transition text-gray-800 font-medium">资源</a>
        
        <!-- 资讯 - 带下拉浮窗（合并资讯、活动） -->
        <div class="nav-dropdown relative group">
          <span class="px-4 py-2 rounded-full hover:bg-gray-300 transition text-gray-800 flex items-center gap-1 cursor-pointer font-medium">
            资讯
            <i class="fa fa-chevron-down text-sm text-gray-500"></i>
          </span>
          <div class="nav-dropdown-menu absolute top-full left-0 mt-2 w-64 bg-white rounded-2xl shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
            <div class="p-4">
              <div class="space-y-3">
                <!-- 资讯 -->
                <a href="news-announcement-list.html" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition">
                  <i class="fa fa-newspaper mr-3 text-[#2D874B]"></i>
                  <span>资讯</span>
                </a>
                
                <!-- 活动 -->
                <a href="activity-list.html" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition">
                  <i class="fa fa-calendar-alt mr-3 text-[#2D874B]"></i>
                  <span>活动</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- 右侧功能区 -->
      <div class="flex items-center space-x-3">
        <!-- 搜索图标（桌面端） -->
        <div class="relative">
          <!-- 搜索图标按钮 -->
          <button id="search-toggle" class="h-9 w-9 rounded-full bg-gray-200/80 hover:bg-gray-300 transition flex items-center justify-center text-gray-600">
            <i class="fa fa-search text-sm"></i>
          </button>
        </div>
        
        <!-- 头像 -->
        <div class="relative">
          <button class="h-9 w-9 rounded-full bg-gray-200/80 hover:bg-gray-300 transition flex items-center justify-center text-gray-600">
            <i class="fa fa-user text-sm"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<main class="pt-16 lg:pt-20 pb-10">
  <!-- 面包屑导航 -->
  <section class="max-w-7xl mx-auto px-4 lg:px-6 mb-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <!-- 返回按钮 -->
        <a href="exam-list.html" class="flex items-center space-x-2 group">
          <button class="h-8 w-8 rounded-full bg-gray-100 border border-gray-300 flex items-center justify-center text-[#2D874B] group-hover:border-[#2D874B]">
            <i class="fa fa-chevron-left text-[#2D874B] text-xs"></i>
          </button>
        </a>
        <!-- 面包屑路径 -->
        <div class="text-xs text-gray-600 flex items-center space-x-1">
          <a href="index.html" class="hover:text-[#2D874B]">首页</a>
          <span>&gt;</span>
          <a href="training.html" class="hover:text-[#2D874B]">培训</a>
          <span>&gt;</span>
          <a href="exam-list.html" class="hover:text-[#2D874B]">考试</a>
          <span>&gt;</span>
          <span class="text-gray-800 font-medium">在线考试</span>
          <span class="text-gray-400">·</span>
          <span class="text-gray-800 font-medium">伙伴云架构工程师（P-Cloud Architect）认证考试</span>
        </div>
      </div>
      <!-- 已答题数 + 剩余时间 -->
      <div class="flex items-center space-x-2 text-xs">
        <span id="answered-info"
              class="inline-flex items-center px-2 py-1 rounded-full bg-gray-200/80 border border-gray-300 text-gray-800">
          已答 <span id="answered-count" class="mx-1 text-[#2D874B]">0</span>/<span id="total-count">0</span>
        </span>
        <span id="time-info"
              class="inline-flex items-center px-2 py-1 rounded-full bg-gray-200/80 border border-gray-300 text-gray-800">
          剩余时间：<span id="timer" class="ml-1 text-amber-600">--:--</span>
        </span>
      </div>
    </div>
  </section>

  <!-- 考生须知弹窗 -->
  <div id="notice-modal"
       class="fixed inset-0 z-50 overlay backdrop-blur-md flex items-center justify-center p-4">
    <div class="glass-card rounded-3xl border border-gray-300 w-full max-w-md p-5">
      <h3 class="text-sm font-semibold mb-3 flex items-center justify-center text-[#2D874B]">
        <i class="fa fa-info-circle mr-2"></i> 考生须知
      </h3>
      <div class="max-h-80 overflow-y-auto mb-4">
        <p class="text-xs text-gray-700 mb-2 leading-5">1. 本场考试总时长为 <strong>60 分钟</strong>，请合理安排答题时间。</p>
        <p class="text-xs text-gray-700 mb-2 leading-5">2. 考试过程中请勿切屏、截图或复制内容，否则将被视为作弊行为。</p>
        <p class="text-xs text-gray-700 mb-2 leading-5">3. 考试开始后将自动计时，时间结束后系统会自动交卷。</p>
        <p class="text-xs text-gray-700 mb-2 leading-5">4. 请确保网络连接稳定，避免因网络问题影响考试。</p>
        <p class="text-xs text-gray-700 mb-2 leading-5">5. 考试过程中如有任何技术问题，请及时联系监考老师。</p>
        <p class="text-xs text-gray-700 mb-2 leading-5">6. 考试成绩将在交卷后立即显示，合格标准为 60 分。</p>
        <p class="text-xs text-gray-700 mb-2 leading-5">7. 本场考试为闭卷考试，请勿查阅任何参考资料。</p>
        <p class="text-xs text-gray-700 mb-2 leading-5">8. 点击"我已知晓"按钮后，考试将正式开始并开始计时。</p>
      </div>
      <div class="flex justify-center space-x-4">
        <button id="notice-cancel" class="px-6 py-2 rounded-full bg-white border border-gray-300 hover:bg-gray-100 text-[11px]">
          取消
        </button>
        <button id="notice-confirm"
                class="px-6 py-2 rounded-full bg-[#2D874B] text-white font-medium hover:bg-[#256e3d] text-[11px]">
          我已知晓
        </button>
      </div>
    </div>
  </div>

  <!-- 切屏/截图提示弹窗 -->
  <div id="warning-modal"
       class="fixed inset-0 z-40 hidden overlay backdrop-blur-md flex items-center justify-center p-4">
    <div class="glass-card rounded-3xl border border-amber-500/60 w-full max-w-sm p-5">
      <h3 class="text-sm font-semibold mb-2 text-amber-600 flex items-center">
        <i class="fa fa-triangle-exclamation mr-2"></i> 考试异常提醒
      </h3>
      <p id="warning-text" class="text-xs text-gray-700 mb-3 leading-5">
        已检测到 1 次切屏，达到 5 次则本次成绩失效。
      </p>
      <div class="flex justify-end">
        <button id="warning-close"
                class="px-4 py-1.5 rounded-full bg-white border border-gray-300 hover:bg-gray-100 text-[11px]">
          我已知晓
        </button>
      </div>
    </div>
  </div>

  <section class="max-w-7xl mx-auto px-4 lg:px-6">
    <div class="grid lg:grid-cols-3 gap-6 items-start">
      <!-- 左侧：题目竖向目录 -->
      <aside class="lg:col-span-1 glass-card rounded-3xl border border-gray-300 p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <span class="h-6 w-1 rounded-full bg-[#B01F24]"></span>
            <h2 class="text-sm font-semibold text-gray-800">试题目录</h2>
          </div>
        </div>
        <div id="question-nav"
             class="space-y-2 text-xs max-h-[560px] overflow-y-auto no-scrollbar">
          <!-- 题目标目录由 JS 注入 -->
        </div>
      </aside>

      <!-- 右侧：答题区域 -->
      <section class="lg:col-span-2 glass-card rounded-3xl border border-gray-300 p-4 md:p-6">
        <!-- 顶部操作区：交卷 -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
          <div class="flex items-center gap-2 text-xs">
            <button id="submit-btn"
                    class="px-4 py-2 rounded-full bg-rose-500 text-white font-medium hover:bg-rose-600 disabled:opacity-40 disabled:cursor-not-allowed">
              交卷
            </button>
          </div>
          <div class="flex items-center gap-3 text-xs text-gray-600">
            <div class="flex items-center gap-1">
              <span class="text-gray-500">自动跳转下一题</span>
              <button id="auto-next-toggle"
                      class="relative inline-flex h-5 w-9 items-center rounded-full bg-gray-200 border border-gray-400 transition">
                <span id="auto-next-thumb"
                      class="inline-block h-4 w-4 transform rounded-full bg-gray-500 translate-x-0 transition"></span>
              </button>
            </div>
            <button id="flag-btn"
                    class="px-3 py-1.5 rounded-full bg-yellow-100 border border-yellow-500 text-[11px] text-yellow-700 hover:bg-yellow-200">
              <i class="fa fa-flag mr-1 text-[10px]"></i> 标记为存疑
            </button>
          </div>
        </div>

        <!-- 当前题目及选项 -->
        <div id="question-area" class="hidden">
          <div class="flex items-start justify-between gap-3 mb-3">
            <div>
              <div id="question-meta" class="text-[11px] text-gray-500 mb-1">
                <!-- 题型 & 序号 -->
              </div>
              <h1 id="question-text" class="text-sm md:text-base font-semibold leading-6">
                <!-- 题干 -->
              </h1>
            </div>
            <div class="text-[11px] text-right text-gray-500">
              <div>当前题：<span id="current-index">1</span>/<span id="total-index">1</span></div>
              <div class="mt-1 flex items-center gap-1">
                <span>本题状态：</span>
                <span id="current-status" class="text-amber-600">未作答</span>
              </div>
            </div>
          </div>

          <!-- 选项列表 -->
          <div id="options-area" class="space-y-2 text-xs">
            <!-- 由 JS 注入 -->
          </div>

          <!-- 底部：上一题 / 下一题 + 小进度条 -->
          <div class="mt-5 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div class="flex items-center gap-2 text-xs">
              <button id="prev-btn"
                      class="px-3 py-1.5 rounded-full bg-white border border-gray-300 hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed">
                <i class="fa fa-chevron-left mr-1 text-[10px]"></i> 上一题
              </button>
              <button id="next-btn"
                      class="px-3 py-1.5 rounded-full bg-white border border-gray-300 hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed">
                下一题 <i class="fa fa-chevron-right ml-1 text-[10px]"></i>
              </button>
            </div>
            <div class="flex-1 md:max-w-xs md:ml-auto">
              <div class="flex items-center justify-between text-[11px] text-gray-500 mb-1">
                <span>考试整体进度</span>
                <span id="overall-progress-text">0%</span>
              </div>
              <div class="w-full h-1.5 rounded-full overflow-hidden progress-bar-track">
                <div id="overall-progress-bar"
                     class="h-full progress-bar-fill"
                     style="width:0%"></div>
              </div>
            </div>
          </div>
        </div>


      </section>
    </div>
  </section>
</main>

<footer class="border-t border-gray-300 mt-8 pt-4 pb-6">
  <div class="max-w-7xl mx-auto px-4 lg:px-6 text-[11px] text-gray-600 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
    <div>© 2026 HIECO 光合技术支持平台 · 考试中心</div>
    <div class="flex flex-wrap gap-3">
      <span>隐私政策</span>
      <span>法律声明</span>
      <span>版权信息</span>
    </div>
  </div>
</footer>

<!-- 考试逻辑脚本 -->
<script>
  // ===================== 模拟考试数据 =====================
  const exam = {
    id: 'exam-cloud-architect',
    durationSeconds: 60 * 60, // 60 分钟
    questions: [
      {
        id: 'q1',
        type: 'judge', // 判断题
        text: 'Kubernetes 的 Pod 是调度的最小单元。',
        options: [
          { id: 'A', text: '正确' },
          { id: 'B', text: '错误' }
        ]
      },
      {
        id: 'q2',
        type: 'single', // 单选题
        text: '以下哪项是 Kubernetes 中用于服务发现的组件？',
        options: [
          { id: 'A', text: 'CoreDNS' },
          { id: 'B', text: 'ZooKeeper' },
          { id: 'C', text: 'Kafka' }
        ]
      },
      {
        id: 'q3',
        type: 'multiple', // 多选题
        text: 'Kubernetes 中用于配置管理的对象包括：',
        options: [
          { id: 'A', text: 'ConfigMap' },
          { id: 'B', text: 'Secret' },
          { id: 'C', text: 'Service' },
          { id: 'D', text: 'Deployment' }
        ]
      },
      {
        id: 'q4',
        type: 'single',
        text: '以下哪种控制器更适合无状态服务的滚动更新？',
        options: [
          { id: 'A', text: 'Deployment' },
          { id: 'B', text: 'DaemonSet' },
          { id: 'C', text: 'Job' }
        ]
      },
      {
        id: 'q5',
        type: 'judge',
        text: 'Helm 可以视为 Kubernetes 的包管理工具。',
        options: [
          { id: 'A', text: '正确' },
          { id: 'B', text: '错误' }
        ]
      },
      {
        id: 'q6',
        type: 'single',
        text: '在 Kubernetes 集群中，当节点出现故障时，Pod 会被自动重新调度到其他健康节点上，这种机制被称为什么？',
        options: [
          { id: 'A', text: '自愈能力' },
          { id: 'B', text: '自动扩展' },
          { id: 'C', text: '负载均衡' }
        ]
      },
      {
        id: 'q7',
        type: 'multiple',
        text: '以下哪些是 Kubernetes 中用于实现服务发现和负载均衡的核心组件，它们共同工作以确保集群内服务的稳定访问？',
        options: [
          { id: 'A', text: 'Service' },
          { id: 'B', text: 'Ingress' },
          { id: 'C', text: 'ConfigMap' },
          { id: 'D', text: 'CoreDNS' }
        ]
      }
    ]
  };

  // ===================== 状态与存储键 =====================
  const STORAGE_KEY = 'exam_answers_' + exam.id;
  const SWITCH_KEY = 'exam_switch_count_' + exam.id;

  let answers = loadAnswers();  // { questionId: 'A' | ['A','B'] | null }
  let flags = {};               // { questionId: true | false }
  let currentIndex = 0;
  let started = false;
  let finished = false;
  let autoNext = false;
  let leftSeconds = exam.durationSeconds;
  let timerId = null;
  let switchCount = loadSwitchCount();

  // ===================== DOM 引用 =====================
  const questionNavEl = document.getElementById('question-nav');
  const answeredCountEl = document.getElementById('answered-count');
  const totalCountEl = document.getElementById('total-count');
  const timerEl = document.getElementById('timer');
  const overallProgressTextEl = document.getElementById('overall-progress-text');
  const overallProgressBarEl = document.getElementById('overall-progress-bar');
  const submitBtn = document.getElementById('submit-btn');
  const autoNextToggle = document.getElementById('auto-next-toggle');
  const autoNextThumb = document.getElementById('auto-next-thumb');
  const flagBtn = document.getElementById('flag-btn');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const questionArea = document.getElementById('question-area');
  const placeholderArea = document.getElementById('placeholder-area');
  const questionMetaEl = document.getElementById('question-meta');
  const questionTextEl = document.getElementById('question-text');
  const optionsAreaEl = document.getElementById('options-area');
  const currentIndexEl = document.getElementById('current-index');
  const totalIndexEl = document.getElementById('total-index');
  const currentStatusEl = document.getElementById('current-status');
  const warningModal = document.getElementById('warning-modal');
  const warningText = document.getElementById('warning-text');
  const warningClose = document.getElementById('warning-close');

  totalCountEl.textContent = exam.questions.length;
  totalIndexEl.textContent = exam.questions.length;

  // ===================== 初始化渲染 =====================
  renderNav();
  updateStats();
  
  // 显示考生须知弹窗
  const noticeModal = document.getElementById('notice-modal');
  const noticeConfirmBtn = document.getElementById('notice-confirm');
  const noticeCancelBtn = document.getElementById('notice-cancel');
  
  noticeModal.classList.remove('hidden');
  
  // 点击"我已知晓"后开始考试
  noticeConfirmBtn.addEventListener('click', () => {
    noticeModal.classList.add('hidden');
    
    // 开始考试
    started = true;
    finished = false;
    submitBtn.disabled = false;
    currentIndex = 0;
    renderQuestion();
    renderNav();
    startTimer();
  });
  
  // 点击"取消"后返回上一页
  noticeCancelBtn.addEventListener('click', () => {
    window.history.back();
  });

  // ===================== 目录渲染 =====================
  function renderNav() {
    questionNavEl.innerHTML = '';
    exam.questions.forEach((q, index) => {
      const navBtn = document.createElement('button');
      const ans = answers[q.id];
      const isAnswered = q.type === 'multiple'
        ? Array.isArray(ans) && ans.length > 0
        : !!ans;
      const isFlagged = flags[q.id];

      let baseCls = 'w-full text-left rounded-2xl border border-gray-300 px-3 py-2 text-xs hover:bg-white transition flex flex-col gap-1';
      if (isAnswered) baseCls += ' question-nav-item-answered';
      if (isFlagged) baseCls += ' question-nav-item-flagged';
      if (index === currentIndex && started && !finished) baseCls += ' question-nav-item-active';

      navBtn.className = baseCls;
      navBtn.dataset.index = index;

      const typeLabel = q.type === 'judge' ? '判断题' : (q.type === 'single' ? '单选题' : '多选题');
      navBtn.innerHTML = `
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="text-[11px] text-gray-500 mb-0.5">第 ${index + 1} 题 · ${typeLabel}</div>
            <div class="line-clamp-1">${q.text}</div>
          </div>
          <div class="ml-2 flex flex-col items-end text-[11px] text-gray-500">
            <span>${isAnswered ? '<span class="text-emerald-600">已答</span>' : '未答'}</span>
            ${isFlagged ? '<span class="text-amber-600 mt-0.5"><i class="fa fa-flag text-[9px] mr-1"></i>存疑</span>' : ''}
          </div>
        </div>
      `;
      navBtn.addEventListener('click', () => {
        if (!started || finished) return;
        currentIndex = index;
        renderQuestion();
        renderNav();
      });
      questionNavEl.appendChild(navBtn);
    });
  }

  // ===================== 渲染当前题目 =====================
  function renderQuestion() {
    const q = exam.questions[currentIndex];
    if (!q) return;

    questionArea.classList.remove('hidden');

    const typeLabel = q.type === 'judge' ? '判断题' : (q.type === 'single' ? '单选题' : '多选题');
    questionMetaEl.textContent = `${typeLabel} · 第 ${currentIndex + 1} 题`;

    questionTextEl.textContent = q.text;
    currentIndexEl.textContent = currentIndex + 1;

    const ans = answers[q.id];
    const isAnswered = q.type === 'multiple'
      ? Array.isArray(ans) && ans.length > 0
      : !!ans;
    const isFlagged = !!flags[q.id];

    currentStatusEl.textContent = isAnswered ? (isFlagged ? '已答（存疑）' : '已答') : (isFlagged ? '未答（存疑）' : '未作答');
    currentStatusEl.className = 'text-[11px] ' + (isAnswered ? 'text-emerald-600' : (isFlagged ? 'text-amber-600' : 'text-gray-500'));

    // 选项
    optionsAreaEl.innerHTML = '';
    q.options.forEach(opt => {
      const btn = document.createElement('button');
      const selected = q.type === 'multiple'
        ? Array.isArray(ans) && ans.includes(opt.id)
        : ans === opt.id;
      btn.className = `w-full text-left rounded-2xl border px-3 py-2 flex items-center gap-2 text-xs
                       ${selected ? 'border-[#B01F24] bg-[#B01F24]/10' : 'border-gray-300 bg-gray-100'}
                       hover:bg-gray-100 transition`;
      btn.dataset.option = opt.id;
      btn.innerHTML = `
        <span class="inline-flex h-5 w-5 items-center justify-center rounded-full border
          ${selected ? 'border-[#B01F24] bg-[#B01F24]/30' : 'border-gray-300 bg-gray-200'}">
          ${selected ? '<i class="fa fa-check text-[10px] text-[#B01F24]"></i>' : ''}
        </span>
        <span class="flex-1">${opt.id}、${opt.text}</span>
      `;
      btn.addEventListener('click', () => handleSelect(q, opt.id));
      optionsAreaEl.appendChild(btn);
    });

    // 上一/下一题按钮状态
    prevBtn.disabled = currentIndex === 0;
    nextBtn.disabled = currentIndex === exam.questions.length - 1;
  }

  function handleSelect(q, optId) {
    if (!started || finished) return;

    if (q.type === 'multiple') {
      let arr = Array.isArray(answers[q.id]) ? [...answers[q.id]] : [];
      if (arr.includes(optId)) {
        arr = arr.filter(id => id !== optId);
      } else {
        arr.push(optId);
      }
      answers[q.id] = arr.length ? arr : null;
    } else {
      answers[q.id] = answers[q.id] === optId ? null : optId;
    }
    saveAnswers(answers);
    updateStats();
    renderQuestion();
    renderNav();

    // 自动跳转下一题
    if (autoNext) {
      const isAnswered = q.type === 'multiple'
        ? Array.isArray(answers[q.id]) && answers[q.id].length > 0
        : !!answers[q.id];
      if (isAnswered && currentIndex < exam.questions.length - 1) {
        currentIndex++;
        renderQuestion();
        renderNav();
      }
    }
  }

  // ===================== 统计 & 进度 =====================
  function updateStats() {
    let answered = 0;
    exam.questions.forEach(q => {
      const ans = answers[q.id];
      const isAns = q.type === 'multiple'
        ? Array.isArray(ans) && ans.length > 0
        : !!ans;
      if (isAns) answered++;
    });
    answeredCountEl.textContent = answered;

    const percent = Math.round(answered / exam.questions.length * 100);
    overallProgressTextEl.textContent = percent + '%';
    overallProgressBarEl.style.width = percent + '%';
  }

  // ===================== 计时器 =====================
  function startTimer() {
    clearInterval(timerId);
    timerId = setInterval(() => {
      if (!started || finished) {
        clearInterval(timerId);
        return;
      }
      leftSeconds--;
      if (leftSeconds <= 0) {
        leftSeconds = 0;
        renderTimer();
        autoSubmit('时间到，系统已自动为你交卷。');
        return;
      }
      renderTimer();
    }, 1000);
    renderTimer();
  }

  function renderTimer() {
    const m = String(Math.floor(leftSeconds / 60)).padStart(2, '0');
    const s = String(leftSeconds % 60).padStart(2, '0');
    timerEl.textContent = `${m}:${s}`;
  }

  // ===================== 交卷 =====================

  submitBtn.addEventListener('click', () => {
    if (!started || finished) return;
    if (!confirm('确认要提前交卷吗？')) return;
    autoSubmit('你已手动交卷，本次作答已提交。');
  });

  function autoSubmit(msg) {
    finished = true;
    started = false;
    clearInterval(timerId);
    submitBtn.disabled = true;

    // 禁用操作
    prevBtn.disabled = true;
    nextBtn.disabled = true;
    flagBtn.disabled = true;
    autoNextToggle.classList.add('opacity-50', 'pointer-events-none');

    alert(msg + '\n（示例页未接入评分接口，仅模拟提交流程）');
    
    // 自动跳转到考试结果页面
    setTimeout(() => {
      window.location.href = 'exam-result.html';
    }, 1000);
  }

  // 上一题 / 下一题
  prevBtn.addEventListener('click', () => {
    if (!started || finished) return;
    if (currentIndex > 0) {
      currentIndex--;
      renderQuestion();
      renderNav();
    }
  });
  nextBtn.addEventListener('click', () => {
    if (!started || finished) return;
    if (currentIndex < exam.questions.length - 1) {
      currentIndex++;
      renderQuestion();
      renderNav();
    }
  });

  // 存疑标记
  flagBtn.addEventListener('click', () => {
    if (!started || finished) return;
    const q = exam.questions[currentIndex];
    flags[q.id] = !flags[q.id];
    renderQuestion();
    renderNav();
  });

  // 自动跳转开关
  autoNextToggle.addEventListener('click', () => {
    if (!started || finished) return;
    autoNext = !autoNext;
    if (autoNext) {
      autoNextToggle.classList.remove('bg-gray-200');
      autoNextToggle.classList.add('bg-[#B01F24]');
      autoNextThumb.style.transform = 'translateX(16px)';
      autoNextThumb.style.backgroundColor = '#FFFFFF';
      autoNextToggle.style.borderColor = '#FFFFFF';
    } else {
      autoNextToggle.classList.add('bg-gray-200');
      autoNextToggle.classList.remove('bg-[#B01F24]');
      autoNextThumb.style.transform = 'translateX(0)';
      autoNextThumb.style.backgroundColor = '';
      autoNextToggle.style.borderColor = '#9ca3af'; /* gray-400 */
    }
  });

  // ===================== 切屏 / 截图复制检测 =====================
  function loadSwitchCount() {
    try {
      const v = localStorage.getItem(SWITCH_KEY);
      return v ? parseInt(v, 10) || 0 : 0;
    } catch {
      return 0;
    }
  }
  function saveSwitchCount(v) {
    localStorage.setItem(SWITCH_KEY, String(v));
  }

  function triggerWarning(typeText) {
    if (!started || finished) return;
    switchCount++;
    saveSwitchCount(switchCount);
    warningText.textContent = `已检测到 ${switchCount} 次${typeText}，达到 5 次则本次成绩失效。`;
    warningModal.classList.remove('hidden');

    if (switchCount >= 5) {
      autoSubmit('已检测到 5 次异常行为，本次成绩已作废并自动交卷。');
    }
  }

  // 切屏：visibilitychange
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      triggerWarning('切屏');
    }
  });

  // 简单截图/复制检测：copy 事件
  document.addEventListener('copy', () => {
    triggerWarning('复制/截图');
  });

  warningClose.addEventListener('click', () => {
    warningModal.classList.add('hidden');
  });

  // ===================== 答案持久化 =====================
  function loadAnswers() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : {};
    } catch {
      return {};
    }
  }
  function saveAnswers(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }
</script>

</body>
</html>